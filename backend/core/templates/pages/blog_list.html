{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Blog" %} - BlisterPerPost{% endblock %}

{% block content %}
<!-- Page Banner -->
<div class="page-banner-area">
  <div class="container">
    <div class="page-banner-content section-title-animation animation-style2">
      <div class="col-lg-10 col-md-12">
        <div class="page-banner-content section-title-animation animation-style2">
          <ul class="meta">
            <li><a href="{% url 'index' %}">{% trans "Startseite" %}</a></li>
            <li>{% trans "Blog" %}</li>
          </ul>
          <h2>{% trans "Unser Blog" %}</h2>
          <p>{% trans "Medikamente einfach organisiert – Tipps, Wissen & Anleitungen" %}</p>
        </div>
      </div>
      <div class="col-lg-2 col-md-12">
        <div class="page-banner-image">
          <img src="{% static 'images/page-banner.png' %}" alt="Banner" width="428" height="562">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Blog List -->
<div class="blog-area ptb-140">
  <div class="container">
    
    <!-- Category Filter -->
    {% if categories %}
    <div class="category-filter mb-5">
      <ul class="nav nav-pills justify-content-center">
        <li class="nav-item">
          <a class="nav-link {% if not current_category %}active{% endif %}" href="{% url 'blog:blog_list' %}">
            {% trans "Alle" %}
          </a>
        </li>
        {% for cat in categories %}
        <li class="nav-item">
          <a class="nav-link {% if current_category.slug == cat.slug %}active{% endif %}" 
             href="{% url 'blog:blog_list' %}?category={{ cat.slug }}">
            {{ cat.name }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    <!-- Posts Grid -->
    <div class="row justify-content-center g-4">
      {% for post in page_obj %}
      <div class="col-lg-4 col-md-6">
        <div class="blog-card">
          <div class="image">
            <a href="{{ post.get_absolute_url }}">
              <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" 
                   loading="lazy" width="832" height="832">
            </a>
          </div>
          <div class="content">
            <ul class="meta">
              {% if post.category %}
              <li><a href="{% url 'blog:blog_list' %}?category={{ post.category.slug }}">{{ post.category.name }}</a></li>
              {% endif %}
              <li>{{ post.published_at|date:"j. F Y" }}</li>
            </ul>
            <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p>{% trans "Keine Beiträge gefunden." %}</p>
      </div>
      {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <nav class="pagination-area mt-5">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category.slug }}{% endif %}">
            &laquo; {% trans "Zurück" %}
          </a>
        </li>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}{% if current_category %}&category={{ current_category.slug }}{% endif %}">{{ num }}</a>
          </li>
          {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category.slug }}{% endif %}">
            {% trans "Weiter" %} &raquo;
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
    
  </div>
</div>

{% include "mainpage/overview.html" %}

{% endblock %}