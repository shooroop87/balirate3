{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Zahlungen" %}{% endblock %}

{% block content %}
<div class="doctor-profile-area pb-140">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 mb-4">
                {% include "account/includes/sidebar.html" %}
            </div>

            <div class="col-lg-9">
                <!-- Payment Methods -->
                <div class="profile-card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2>{% trans "Zahlungsmethoden" %}</h2>
                        <a href="{% url 'account_payment_method_add' %}" class="btn btn-sm btn-outline-primary">
                            {% trans "Hinzufügen" %}
                        </a>
                    </div>
                    <div class="card-body">
                        {% if user.payment_methods.all %}
                        <div class="payment-methods">
                            {% for pm in user.payment_methods.all %}
                            <div class="payment-method-card">
                                <div class="pm-icon">
                                    {% if pm.type == 'card' %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#336AEA" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                                    {% else %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#336AEA" stroke-width="2"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
                                    {% endif %}
                                </div>
                                <div class="pm-info">
                                    <h4>
                                        {% if pm.type == 'card' %}
                                        {{ pm.brand|title }} •••• {{ pm.last4 }}
                                        {% else %}
                                        SEPA •••• {{ pm.last4 }}
                                        {% endif %}
                                    </h4>
                                    {% if pm.exp_month and pm.exp_year %}
                                    <span>{% trans "Gültig bis" %} {{ pm.exp_month }}/{{ pm.exp_year }}</span>
                                    {% endif %}
                                </div>
                                {% if pm.is_default %}
                                <span class="badge bg-success">{% trans "Standard" %}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">{% trans "Keine Zahlungsmethoden hinterlegt." %}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Payment History -->
                <div class="profile-card">
                    <div class="card-header">
                        <h2>{% trans "Zahlungsverlauf" %}</h2>
                    </div>
                    <div class="card-body">
                        {% if payments %}
                        <div class="payments-table">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>{% trans "Datum" %}</th>
                                        <th>{% trans "Beschreibung" %}</th>
                                        <th>{% trans "Betrag" %}</th>
                                        <th>{% trans "Status" %}</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for payment in payments %}
                                    <tr>
                                        <td>{{ payment.created_at|date:"d.m.Y" }}</td>
                                        <td>{{ payment.description|default:"-" }}</td>
                                        <td><strong>{{ payment.amount }} {{ payment.currency }}</strong></td>
                                        <td>
                                            <span class="badge 
                                                {% if payment.status == 'succeeded' %}bg-success
                                                {% elif payment.status == 'failed' %}bg-danger
                                                {% elif payment.status == 'refunded' %}bg-info
                                                {% else %}bg-warning{% endif %}">
                                                {{ payment.get_status_display }}
                                            </span>
                                        </td>
                                        <td>
                                            {% if payment.receipt_url %}
                                            <a href="{{ payment.receipt_url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                                {% trans "Quittung" %}
                                            </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                            <h4>{% trans "Keine Zahlungen" %}</h4>
                            <p>{% trans "Ihre Zahlungshistorie erscheint hier." %}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.profile-card { background: #fff; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; }
.profile-card .card-header { background: transparent; border-bottom: 1px solid #f0f0f0; padding: 20px 25px; }
.profile-card .card-header h2 { font-size: 20px; margin: 0; }
.profile-card .card-body { padding: 25px; }

.payment-methods { display: flex; flex-direction: column; gap: 10px; }
.payment-method-card { display: flex; align-items: center; gap: 15px; background: #f8f9fa; border-radius: 10px; padding: 15px; }
.pm-icon { width: 45px; height: 45px; background: rgba(51, 106, 234, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
.pm-info { flex: 1; }
.pm-info h4 { margin: 0 0 3px; font-size: 15px; }
.pm-info span { font-size: 13px; color: #5A6A85; }

.table { margin-bottom: 0; }
.table th { border-top: none; font-weight: 600; color: #5A6A85; font-size: 13px; }
.empty-state { text-align: center; padding: 50px 20px; }
.empty-state svg { margin-bottom: 20px; }
.empty-state h4 { margin-bottom: 10px; }
.empty-state p { color: #5A6A85; }
</style>
{% endblock %}