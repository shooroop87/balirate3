{% load static i18n socialaccount %}

<!-- Auth Modal -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content auth-modal">
            <button type="button" class="btn-close-modal" data-bs-dismiss="modal" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
            
            <!-- Login View -->
            <div class="auth-view" id="loginView">
                <div class="auth-header">
                    <div class="auth-logo">
                        <svg width="50" height="50" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M31.1503 8.44942C30.705 7.75915 30.0844 7.19806 29.3511 6.82289L18.7287 0.719574C17.8995 0.24519 16.9596 -0.00429206 16.0031 -0.0039058C15.0465 -0.00351954 14.1068 0.246721 13.2781 0.721775L2.65566 6.82289C1.81694 7.30271 0.690518 8.19411 0.601998 9.31441C0.393976 11.982 3.84626 13.6459 6.15442 14.8719C10.1378 16.976 12.6983 18.1954 14.6391 20.1718C15.0706 20.612 15.7456 21.3802 16.0045 21.9855C16.2568 21.3802 16.9384 20.6098 17.3677 20.1718C19.3085 18.191 21.88 16.976 25.8546 14.8719C28.1273 13.6701 31.4667 12.1427 31.4026 9.32101C31.3845 9.01547 31.2983 8.71776 31.1503 8.44942Z" fill="url(#paint0)"/>
                            <path d="M25.8678 16.633C21.143 19.1289 17.8279 20.2932 16.54 24.3364C16.3087 24.982 16.1275 25.6442 15.9978 26.3173C15.8705 25.6441 15.6907 24.9818 15.46 24.3364C14.1632 20.3042 10.857 19.1487 6.13223 16.644C1.23043 14.0534 0.183679 12.7658 0 12.209V23.7157C0.0014291 24.6635 0.252969 25.5943 0.729475 26.415C1.20598 27.2358 1.89076 27.9178 2.71535 28.3928L13.3378 34.4873C13.6863 34.6981 14.0574 34.8694 14.4443 34.998C14.3159 34.5445 14.1654 34.0647 13.9817 33.5541C10.6622 24.31 4.79779 22.0386 4.79779 22.0386C4.79779 22.0386 7.53084 22.2587 11.4368 26.2689C13.3289 28.2145 14.816 30.541 16.0022 32.9642C16.0022 32.9642 18.6091 28.2762 20.5721 26.2579C24.478 22.2455 27.2111 22.0276 27.2111 22.0276C27.2111 22.0276 21.3422 24.3012 18.0271 33.5431C17.8434 34.0559 17.6907 34.5335 17.5624 34.9891C17.9486 34.859 18.3196 34.6878 18.6689 34.4785L29.2824 28.3928C30.1075 27.9175 30.7926 27.2352 31.2695 26.4141C31.7464 25.593 31.9983 24.6618 32 23.7135V12.2002C31.8141 12.746 30.7607 14.0446 25.8678 16.633Z" fill="url(#paint1)"/>
                            <defs>
                                <linearGradient id="paint0" x1="0.595" y1="10.99" x2="31.4" y2="10.99" gradientUnits="userSpaceOnUse"><stop stop-color="#336AEA"/><stop offset="1" stop-color="#87ABFF"/></linearGradient>
                                <linearGradient id="paint1" x1="19.74" y1="7.15" x2="9.62" y2="37.83" gradientUnits="userSpaceOnUse"><stop stop-color="#2A3547"/><stop offset="1" stop-color="#707070"/></linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <h2>{% trans "Willkommen zurück" %}</h2>
                    <p>{% trans "Melden Sie sich in Ihrem Konto an" %}</p>
                </div>
                
                <!-- Social Login -->
                <div class="social-buttons">
                    {% get_providers as socialaccount_providers %}
                    {% for provider in socialaccount_providers %}
                        {% if provider.id == 'google' %}
                        <a href="{% provider_login_url 'google' %}" class="btn-social google">
                            <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                            {% trans "Mit Google fortfahren" %}
                        </a>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="auth-divider"><span>{% trans "oder mit E-Mail" %}</span></div>
                
                <!-- Login Form -->
                <form method="post" action="{% url 'account_login' %}" class="auth-form" id="loginForm">
                    {% csrf_token %}
                    <div class="form-floating">
                        <input type="email" class="form-control" id="loginEmail" name="login" placeholder="name@beispiel.de" required>
                        <label for="loginEmail">{% trans "E-Mail-Adresse" %}</label>
                    </div>
                    <div class="form-floating">
                        <input type="password" class="form-control" id="loginPassword" name="password" placeholder="Passwort" required>
                        <label for="loginPassword">{% trans "Passwort" %}</label>
                    </div>
                    <div class="form-options">
                        <label class="form-check">
                            <input type="checkbox" name="remember" class="form-check-input" checked>
                            <span>{% trans "Angemeldet bleiben" %}</span>
                        </label>
                        <a href="{% url 'account_reset_password' %}" class="forgot-link">{% trans "Passwort vergessen?" %}</a>
                    </div>
                    <button type="submit" class="btn-auth-submit">{% trans "Anmelden" %}</button>
                </form>
                
                <div class="auth-footer">
                    {% trans "Noch kein Konto?" %}
                    <a href="#" onclick="showRegisterView(); return false;">{% trans "Jetzt registrieren" %}</a>
                </div>
            </div>
            
            <!-- Register View -->
            <div class="auth-view" id="registerView" style="display: none;">
                <div class="auth-header">
                    <div class="auth-logo">
                        <svg width="50" height="50" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M31.1503 8.44942C30.705 7.75915 30.0844 7.19806 29.3511 6.82289L18.7287 0.719574C17.8995 0.24519 16.9596 -0.00429206 16.0031 -0.0039058C15.0465 -0.00351954 14.1068 0.246721 13.2781 0.721775L2.65566 6.82289C1.81694 7.30271 0.690518 8.19411 0.601998 9.31441C0.393976 11.982 3.84626 13.6459 6.15442 14.8719C10.1378 16.976 12.6983 18.1954 14.6391 20.1718C15.0706 20.612 15.7456 21.3802 16.0045 21.9855C16.2568 21.3802 16.9384 20.6098 17.3677 20.1718C19.3085 18.191 21.88 16.976 25.8546 14.8719C28.1273 13.6701 31.4667 12.1427 31.4026 9.32101C31.3845 9.01547 31.2983 8.71776 31.1503 8.44942Z" fill="url(#paint0r)"/>
                            <path d="M25.8678 16.633C21.143 19.1289 17.8279 20.2932 16.54 24.3364C16.3087 24.982 16.1275 25.6442 15.9978 26.3173C15.8705 25.6441 15.6907 24.9818 15.46 24.3364C14.1632 20.3042 10.857 19.1487 6.13223 16.644C1.23043 14.0534 0.183679 12.7658 0 12.209V23.7157C0.0014291 24.6635 0.252969 25.5943 0.729475 26.415C1.20598 27.2358 1.89076 27.9178 2.71535 28.3928L13.3378 34.4873C13.6863 34.6981 14.0574 34.8694 14.4443 34.998C14.3159 34.5445 14.1654 34.0647 13.9817 33.5541C10.6622 24.31 4.79779 22.0386 4.79779 22.0386C4.79779 22.0386 7.53084 22.2587 11.4368 26.2689C13.3289 28.2145 14.816 30.541 16.0022 32.9642C16.0022 32.9642 18.6091 28.2762 20.5721 26.2579C24.478 22.2455 27.2111 22.0276 27.2111 22.0276C27.2111 22.0276 21.3422 24.3012 18.0271 33.5431C17.8434 34.0559 17.6907 34.5335 17.5624 34.9891C17.9486 34.859 18.3196 34.6878 18.6689 34.4785L29.2824 28.3928C30.1075 27.9175 30.7926 27.2352 31.2695 26.4141C31.7464 25.593 31.9983 24.6618 32 23.7135V12.2002C31.8141 12.746 30.7607 14.0446 25.8678 16.633Z" fill="url(#paint1r)"/>
                            <defs>
                                <linearGradient id="paint0r" x1="0.595" y1="10.99" x2="31.4" y2="10.99" gradientUnits="userSpaceOnUse"><stop stop-color="#336AEA"/><stop offset="1" stop-color="#87ABFF"/></linearGradient>
                                <linearGradient id="paint1r" x1="19.74" y1="7.15" x2="9.62" y2="37.83" gradientUnits="userSpaceOnUse"><stop stop-color="#2A3547"/><stop offset="1" stop-color="#707070"/></linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <h2>{% trans "Konto erstellen" %}</h2>
                    <p>{% trans "Starten Sie mit Ihrem Blister-Service" %}</p>
                </div>
                
                <!-- Social Register -->
                <div class="social-buttons">
                    {% get_providers as socialaccount_providers %}
                    {% for provider in socialaccount_providers %}
                        {% if provider.id == 'google' %}
                        <a href="{% provider_login_url 'google' %}" class="btn-social google">
                            <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                            {% trans "Mit Google registrieren" %}
                        </a>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="auth-divider"><span>{% trans "oder mit E-Mail" %}</span></div>
                
                <!-- Register Form -->
                <form method="post" action="{% url 'account_signup' %}" class="auth-form" id="registerForm">
                    {% csrf_token %}
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="regFirstName" name="first_name" placeholder="Vorname" required>
                                <label for="regFirstName">{% trans "Vorname" %}</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="regLastName" name="last_name" placeholder="Nachname" required>
                                <label for="regLastName">{% trans "Nachname" %}</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-floating">
                        <input type="email" class="form-control" id="regEmail" name="email" placeholder="name@beispiel.de" required>
                        <label for="regEmail">{% trans "E-Mail-Adresse" %}</label>
                    </div>
                    <div class="form-floating">
                        <input type="password" class="form-control" id="regPassword" name="password1" placeholder="Passwort" minlength="8" required>
                        <label for="regPassword">{% trans "Passwort (mind. 8 Zeichen)" %}</label>
                    </div>
                    <div class="form-floating">
                        <input type="password" class="form-control" id="regPassword2" name="password2" placeholder="Passwort bestätigen" required>
                        <label for="regPassword2">{% trans "Passwort bestätigen" %}</label>
                    </div>
                    <div class="form-check-group">
                        <label class="form-check">
                            <input type="checkbox" name="terms_accepted" class="form-check-input" required checked>
                            <span>{% trans "Ich akzeptiere die" %} <a href="{% url 'terms' %}" target="_blank">{% trans "AGB" %}</a> {% trans "und" %} <a href="{% url 'privacy' %}" target="_blank">{% trans "Datenschutz" %}</a></span>
                        </label>
                    </div>
                    <button type="submit" class="btn-auth-submit">{% trans "Konto erstellen" %}</button>
                </form>
                
                <div class="auth-footer">
                    {% trans "Bereits ein Konto?" %}
                    <a href="#" onclick="showLoginView(); return false;">{% trans "Jetzt anmelden" %}</a>
                </div>
            </div>
            
            <!-- Email Sent View -->
            <div class="auth-view" id="emailSentView" style="display: none;">
                <div class="auth-header">
                    <div class="success-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    </div>
                    <h2>{% trans "E-Mail gesendet!" %}</h2>
                    <p>{% trans "Wir haben Ihnen eine Bestätigungs-E-Mail gesendet. Bitte klicken Sie auf den Link in der E-Mail." %}</p>
                </div>
                <div class="email-tips">
                    <p><strong>{% trans "Keine E-Mail erhalten?" %}</strong></p>
                    <ul>
                        <li>{% trans "Überprüfen Sie Ihren Spam-Ordner" %}</li>
                        <li>{% trans "Warten Sie einige Minuten" %}</li>
                    </ul>
                </div>
                <button type="button" class="btn-auth-submit secondary" data-bs-dismiss="modal">{% trans "Verstanden" %}</button>
            </div>
        </div>
    </div>
</div>
<style>
/* Modal Base */
.auth-modal {
    border: none;
    border-radius: 24px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    overflow: hidden;
    max-width: 420px;
    margin: 0 auto;
}
.auth-modal .btn-close-modal {
    position: absolute;
    top: 16px;
    right: 16px;
    background: #f3f4f6;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 10;
}
.auth-modal .btn-close-modal:hover {
    background: #e5e7eb;
    transform: rotate(90deg);
}
.auth-modal .btn-close-modal svg { color: #6b7280; }

/* Auth View */
.auth-view { padding: 40px 35px; }
.auth-header { text-align: center; margin-bottom: 30px; }
.auth-header .auth-logo { margin-bottom: 20px; }
.auth-header h2 { font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 8px; }
.auth-header p { color: #6b7280; font-size: 15px; margin: 0; }

/* Social Buttons */
.social-buttons { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
.btn-social {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 14px 20px;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    background: #fff;
    color: #374151;
    font-size: 15px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s;
}
.btn-social:hover {
    border-color: #336AEA;
    background: #f8fafc;
    color: #374151;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(51, 106, 234, 0.15);
}
.btn-social.google:hover { border-color: #4285F4; }

/* Divider */
.auth-divider {
    display: flex;
    align-items: center;
    margin: 24px 0;
    color: #9ca3af;
    font-size: 13px;
}
.auth-divider::before,
.auth-divider::after {
    content: "";
    flex: 1;
    height: 1px;
    background: #e5e7eb;
}
.auth-divider span { padding: 0 16px; }

/* Form */
.auth-form { display: flex; flex-direction: column; gap: 16px; }
.auth-form .form-floating { position: relative; }
.auth-form .form-floating .form-control {
    height: 56px;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 16px 16px 0px 16px;
    font-size: 15px;
    transition: all 0.2s;
}
.auth-form .form-floating .form-control:focus {
    border-color: #336AEA;
    box-shadow: 0 0 0 4px rgba(51, 106, 234, 0.1);
}
.auth-form .form-floating label {
    padding: 16px;
    color: #9ca3af;
}
.auth-form .form-floating .form-control:focus ~ label,
.auth-form .form-floating .form-control:not(:placeholder-shown) ~ label {
    color: #336AEA;
}

/* Form Options */
.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
}
.form-options .form-check {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 0;
    cursor: pointer;
}
.form-options .form-check-input {
    width: 18px;
    height: 18px;
    margin: 0;
    cursor: pointer;
}
.form-options .form-check-input:checked {
    background-color: #336AEA;
    border-color: #336AEA;
}
.forgot-link { color: #336AEA; text-decoration: none; }
.forgot-link:hover { text-decoration: underline; }

/* Checkboxes Group */
.form-check-group { display: flex; flex-direction: column; gap: 12px; }
.form-check-group .form-check {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 13px;
    color: #6b7280;
    cursor: pointer;
    margin: 0;
}
.form-check-group .form-check-input {
    width: 18px;
    height: 18px;
    margin-top: 2px;
    flex-shrink: 0;
}
.form-check-group a { color: #336AEA; }

/* Submit Button */
.btn-auth-submit {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #336AEA 0%, #5b8def 100%);
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 8px;
}
.btn-auth-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(51, 106, 234, 0.35);
}
.btn-auth-submit.secondary {
    background: #f3f4f6;
    color: #374151;
}
.btn-auth-submit.secondary:hover {
    background: #e5e7eb;
    box-shadow: none;
}

/* Footer */
.auth-footer {
    text-align: center;
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid #f3f4f6;
    font-size: 14px;
    color: #6b7280;
}
.auth-footer a {
    color: #336AEA;
    font-weight: 500;
    text-decoration: none;
}
.auth-footer a:hover { text-decoration: underline; }

/* Success Icon */
.success-icon {
    width: 100px;
    height: 100px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
}

/* Email Tips */
.email-tips {
    background: #f8fafc;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
    text-align: left;
}
.email-tips p { margin: 0 0 10px; font-size: 14px; }
.email-tips ul {
    margin: 0;
    padding-left: 20px;
    font-size: 13px;
    color: #6b7280;
}
.email-tips li { margin-bottom: 5px; }

/* Animations */
@keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.95) translateY(-10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}
.modal.show .auth-modal {
    animation: modalFadeIn 0.3s ease-out;
}

/* Responsive */
@media (max-width: 480px) {
    .auth-modal { margin: 10px; border-radius: 20px; }
    .auth-view { padding: 30px 24px; }
    .auth-header h2 { font-size: 22px; }
    .form-options { flex-direction: column; gap: 12px; align-items: flex-start; }
}
</style>

<script>
function showLoginView() {
    document.getElementById('loginView').style.display = 'block';
    document.getElementById('registerView').style.display = 'none';
    document.getElementById('emailSentView').style.display = 'none';
}

function showRegisterView() {
    document.getElementById('loginView').style.display = 'none';
    document.getElementById('registerView').style.display = 'block';
    document.getElementById('emailSentView').style.display = 'none';
}

function showEmailSentView() {
    document.getElementById('loginView').style.display = 'none';
    document.getElementById('registerView').style.display = 'none';
    document.getElementById('emailSentView').style.display = 'block';
}

// Open modal with specific view
function openAuthModal(view = 'login') {
    const modal = new bootstrap.Modal(document.getElementById('authModal'));
    if (view === 'register') {
        showRegisterView();
    } else {
        showLoginView();
    }
    modal.show();
}

// Reset to login view when modal closes
document.getElementById('authModal')?.addEventListener('hidden.bs.modal', function () {
    showLoginView();
});

// Password match validation
document.getElementById('registerForm')?.addEventListener('submit', function(e) {
    const pw1 = document.getElementById('regPassword').value;
    const pw2 = document.getElementById('regPassword2').value;
    if (pw1 !== pw2) {
        e.preventDefault();
        alert('{% trans "Passwörter stimmen nicht überein" %}');
        return false;
    }
});
</script>